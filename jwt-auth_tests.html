<!DOCTYPE html>
<html lang="en">


<head>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.5/angular.min.js"></script>
</head>

<body ng-app="myapp">

<div ng-controller="MyController">
    <button ng-click="myData.regClick(item, $event)">Register a user</button>
    <button ng-click="myData.logClick(item, $event)">Login</button>
    <button ng-click="myData.tokClick(item, $event)">Get Restricted User OBJs with Token</button>
    <button ng-click="myData.tokusrClick(item, $event)">Get Restricted current User OBJ with Token</button>
    <br/>
    <label class="item item-input">
        <span class="input-label">user</span>
        <input type="text" ng-model="myData.username">
    </label>
    <label class="item item-input">
        <span class="input-label">Password</span>
        <input type="text" ng-model="myData.password">
    </label>
    <label class="item item-input">
        <span class="input-label">Email</span>
        <input type="text" ng-model="myData.email">
    </label>

</div>

<script>
    angular.module("myapp", [])
            .controller("MyController", function ($scope, $http) {
                $scope.myData = {};


                $scope.myData.regClick = function (item, event) {
                    var dataObj = {
                        username: $scope.myData.username,
                        password: $scope.myData.password,
                        email: $scope.myData.email

                    };
                    $http.defaults.headers.common['x-auth'] = "";
                    //REGISTER A NEW USER
                    var res = $http.post('http://localhost:8080/api/auth/register', dataObj);
                    res.success(function (data, status, headers, config) {
                        alert(JSON.stringify({data: data}));
                    });
                    res.error(function (data, status, headers, config) {
                        alert("failure message: " + JSON.stringify({data: data}));
                    });

                }

                $scope.myData.logClick = function (item, event) {
                    var dataObj = {
                        username: $scope.myData.username,
                        password: $scope.myData.password

                    };

                    $http.defaults.headers.common['x-auth'] = "";
                    //LOG A NEW USER IN
                    var res = $http.post('http://localhost:8080/api/auth/login', dataObj);
                    res.success(function (data, status, headers, config) {
                        alert('token set');
                        localStorage.jwttoken = data;
                    });
                    res.error(function (data, status, headers, config) {
                        alert("failure message: " + JSON.stringify({data: data}));
                    });

                }

                $scope.myData.tokClick = function (item, event) {


                    //RETRIEVE RESPONSE FROM LOGIN AND SET X-AUTH HEADER TO ACCESS RESTRICTED RESOURCES
                    $http.defaults.headers.common['x-auth'] = localStorage.jwttoken;
                    var res = $http.post('http://localhost:8080/api/users');
                    res.success(function (data, status, headers, config) {
                        alert(JSON.stringify({data: data}));
                    });
                    res.error(function (data, status, headers, config) {
                        alert("failure message: " + JSON.stringify({data: data}));
                    });

                }

                $scope.myData.tokusrClick = function (item, event) {


                    //RETRIEVE RESPONSE FROM LOGIN AND SET X-AUTH HEADER TO ACCESS RESTRICTED RESOURCES
                    $http.defaults.headers.common['x-auth'] = localStorage.jwttoken;
                    var res = $http.get('http://localhost:8080/api/users');
                    res.success(function (data, status, headers, config) {
                        alert(JSON.stringify({data: data}));
                    });
                    res.error(function (data, status, headers, config) {
                        alert("failure message: " + JSON.stringify({data: data}));
                    });

                }

            });
</script>

</body>

</html>